name: âš™ï¸ Gen - ç”Ÿæˆä¸æ¨è¿›

on:
  workflow_dispatch: # æ‰‹åŠ¨è§¦å‘

permissions:
  contents: write # å…è®¸å·¥ä½œæµæ¨é€ä»£ç 

jobs:
  generate-and-push:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ—‚ï¸ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: â” è®¾ç½® Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: ğŸ› ï¸ è¿è¡Œç”Ÿæˆè„šæœ¬ (å”¯ä¸€æ¥æº)
        run: node tools/gen_dist.js

      - name: ğŸ“ æ£€æŸ¥æ˜¯å¦æœ‰å˜æ›´å¹¶æäº¤
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git add dist/
          if git diff --staged --quiet; then
            echo "æ²¡æœ‰æ£€æµ‹åˆ° dist ç›®å½•çš„å˜æ›´ï¼Œæ— éœ€æäº¤ã€‚"
          else
            git commit -m "chore(dist): ç”± gen.yml è‡ªåŠ¨ç”Ÿæˆï¼Œæ›´æ–° FeaturePanel å®Œæ•´å®ç°"
            git push
            echo "å·²æäº¤å¹¶æ¨é€ç”Ÿæˆçš„ dist ç›®å½•ã€‚"
          fi
